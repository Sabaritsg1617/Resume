<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Camera + QR Scanner + Video Recorder</title>

<style>
  body { font-family: Arial, sans-serif; margin: 20px; font-size: 1.2rem; }
  label { font-weight: bold; display: block; margin-top: 15px; }
  #reader { width: 300px; margin-top: 15px; border: 2px solid #444; }
  #result-box { margin-top: 10px; font-size: 1.4rem; font-weight: bold; color: green; }
  #previewVideo { width: 320px; border: 2px solid #444; margin-top: 10px; }
  button { font-size: 1.2rem; padding: 10px 20px; margin-top: 10px; }
</style>

<script src="https://unpkg.com/html5-qrcode"></script>
</head>

<body>

<h2>üì∑ Camera + QR + Video Recorder</h2>

<!-- Capture Rear -->
<label>Capture from Back Camera:</label>
<input type="file" capture="environment" accept="image/*,video/*">

<!-- Capture Front -->
<label>Capture from Front Camera:</label>
<input type="file" capture="user" accept="image/*">

<hr>

<!-- Video Recorder -->
<h3>üé• Video Recorder</h3>
<video id="previewVideo" autoplay playsinline></video><br>
<button id="startRec">Start Recording</button>
<button id="stopRec" disabled>Stop Recording</button>
<a id="downloadLink" style="display:none;">Download Video</a>

<script>
let mediaStream;
let mediaRecorder;
let recordedChunks = [];

async function startCamera() {
  mediaStream = await navigator.mediaDevices.getUserMedia({ video: true, audio: true });
  document.getElementById("previewVideo").srcObject = mediaStream;
}

document.getElementById("startRec").onclick = () => {
  recordedChunks = [];
  mediaRecorder = new MediaRecorder(mediaStream);

  mediaRecorder.ondataavailable = e => {
    if (e.data.size > 0) recordedChunks.push(e.data);
  };

  mediaRecorder.onstop = () => {
    const blob = new Blob(recordedChunks, { type: "video/webm" });
    const url = URL.createObjectURL(blob);
    const link = document.getElementById("downloadLink");
    link.href = url;
    link.download = "RecordedVideo.webm";
    link.style.display = "block";
    link.innerText = "‚¨áÔ∏è Download Recorded Video";
  };

  mediaRecorder.start();
  document.getElementById("startRec").disabled = true;
  document.getElementById("stopRec").disabled = false;
};

document.getElementById("stopRec").onclick = () => {
  mediaRecorder.stop();
  document.getElementById("startRec").disabled = false;
  document.getElementById("stopRec").disabled = true;
};

// Start camera preview
startCamera();
</script>

<hr>

<!-- QR Scanner -->
<h3>üîç QR Code Scanner</h3>
<div id="reader"></div>
<div id="result-box">Result will appear here...</div>

<script>
function onScanSuccess(decodedText) {
  document.getElementById("result-box").innerHTML = "‚úÖ QR Code: " + decodedText;
}
let qrScanner = new Html5QrcodeScanner("reader", { fps: 10, qrbox: 250 });
qrScanner.render(onScanSuccess);
</script>

</body>
</html>
